<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Force One | Florian M.</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Leaflet CSS for Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #000000; /* Absolutes Schwarz */
            overflow-x: hidden;
            color: #ffffff;
        }

        /* --- LENIS SMOOTH SCROLLING CSS --- */
        html.lenis, html.lenis body {
            height: auto;
        }

        .lenis.lenis-smooth {
            scroll-behavior: auto !important;
        }

        .lenis.lenis-smooth [data-lenis-prevent] {
            overscroll-behavior: contain;
        }

        .lenis.lenis-stopped {
            overflow: hidden;
        }

        .lenis.lenis-scrolling iframe {
            pointer-events: none;
        }

        /* --- SUBTLE & DARK Background Animation Blobs --- */
        .blob {
            position: fixed;
            filter: blur(120px);
            z-index: -1;
            opacity: 0.12;
        }
        
        .blob-1 {
            top: -10%;
            left: -5%;
            width: 850px;
            height: 850px;
            background: #0d9488; 
            border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%;
            animation: float1 22s infinite alternate ease-in-out;
        }
        
        .blob-2 {
            bottom: -15%;
            right: -5%;
            width: 950px;
            height: 950px;
            background: #115e59; 
            border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
            animation: float2 28s infinite alternate ease-in-out;
        }

        .blob-3 {
            top: 25%;
            left: 20%;
            width: 700px;
            height: 700px;
            background: #0e7490; 
            border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
            animation: float3 25s infinite alternate ease-in-out;
        }

        @keyframes float1 {
            0% { transform: translate(0, 0) rotate(0deg) scale(1); }
            33% { transform: translate(120px, 80px) rotate(15deg) scale(1.15); }
            66% { transform: translate(-60px, 150px) rotate(-10deg) scale(0.9); }
            100% { transform: translate(40px, -40px) rotate(5deg) scale(1.05); }
        }

        @keyframes float2 {
            0% { transform: translate(0, 0) rotate(0deg) scale(1.1); }
            40% { transform: translate(-150px, -100px) rotate(-20deg) scale(0.85); }
            80% { transform: translate(100px, -200px) rotate(10deg) scale(1.2); }
            100% { transform: translate(-20px, 40px) rotate(-5deg) scale(1); }
        }

        @keyframes float3 {
            0% { transform: translate(0, 0) rotate(0deg) scale(1); opacity: 0.1; }
            50% { transform: translate(250px, 100px) rotate(180deg) scale(1.3); opacity: 0.2; }
            100% { transform: translate(-100px, -50px) rotate(360deg) scale(0.9); opacity: 0.1; }
        }

        /* --- ULTRA GLASSY PANELS --- */
        .glass-panel {
            position: relative;
            background: rgba(255, 255, 255, 0.015); 
            backdrop-filter: blur(30px) saturate(200%);
            -webkit-backdrop-filter: blur(30px) saturate(200%);
            border-top: 1px solid rgba(255, 255, 255, 0.15);
            border-left: 1px solid rgba(255, 255, 255, 0.08);
            border-right: 1px solid rgba(255, 255, 255, 0.04);
            border-bottom: 1px solid rgba(255, 255, 255, 0.01);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.9), inset 0 0 20px rgba(255, 255, 255, 0.01);
            transition: all 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
            overflow: hidden; 
        }

        .neon-title {
            color: #2dd4bf;
            text-shadow: 0 0 10px rgba(45, 212, 191, 0.6), 0 0 25px rgba(45, 212, 191, 0.4), 0 0 50px rgba(45, 212, 191, 0.2);
            letter-spacing: 0.05em;
        }

        /* Subtiler Glow für KPI Zahlen */
        .glow-number {
            text-shadow: 0 0 12px rgba(45, 212, 191, 0.4);
        }

        .glass-header {
            background: rgba(0, 0, 0, 0.85); 
            backdrop-filter: blur(30px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.04);
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .glass-panel::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.01) 50%, rgba(255,255,255,0.00) 100%);
            pointer-events: none;
            z-index: 1;
        }

        .glass-panel:hover {
            transform: translateY(-4px);
            background: rgba(255, 255, 255, 0.03);
            border-top-color: rgba(255, 255, 255, 0.3);
            box-shadow: 0 30px 70px rgba(0, 0, 0, 1);
        }

        .glass-btn {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .glass-btn:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(45, 212, 191, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.7), 0 0 15px rgba(45, 212, 191, 0.2);
        }
        
        .nav-link {
            position: relative;
            color: rgba(255,255,255,0.4);
            transition: all 0.3s;
        }
        .nav-link:hover, .nav-link.active {
            color: #2dd4bf;
            text-shadow: 0 0 15px rgba(45, 212, 191, 0.5);
        }
        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -24px;
            left: 0;
            width: 100%;
            height: 2px;
            background: #2dd4bf;
            box-shadow: 0 0 20px #2dd4bf;
            border-radius: 4px 4px 0 0;
        }

        .glass-input {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.06);
            color: white;
            box-shadow: inset 0 3px 6px 0 rgba(0,0,0,0.8);
        }
        
        .glass-input:focus {
            outline: none;
            border-color: rgba(45, 212, 191, 0.5);
            background: rgba(0, 0, 0, 0.9);
            box-shadow: 0 0 25px rgba(45, 212, 191, 0.15);
        }

        /* Progress Bar Animation */
        .progress-bar {
            transition: width 1.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .pipeline-scroll { max-height: 500px; overflow-y: auto; padding-right: 5px; }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #000000; }
        ::-webkit-scrollbar-thumb { background: #222; border-radius: 3px; }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col items-center selection:bg-teal-500 selection:text-white">

    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>

    <!-- Header -->
    <header class="w-full glass-header mb-8">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 h-20 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="font-black text-xl tracking-wider uppercase neon-title">SALES FORCE ONE</div>
            </div>
            <nav class="hidden md:flex items-center gap-8 font-medium text-sm">
                <a href="#" class="nav-link active py-6">Cockpit</a>
                <a href="#" class="nav-link py-6">Pipeline</a>
                <a href="#" class="nav-link py-6">Kunden</a>
                <a href="#" class="nav-link py-6">Analysen</a>
            </nav>
            <div class="flex items-center gap-4">
                <button class="glass-btn w-10 h-10 rounded-full flex items-center justify-center text-white/80 hover:text-white"><i class="fa-regular fa-bell"></i></button>
                <div class="flex items-center gap-3 pl-4 border-l border-white/10">
                    <div class="text-right hidden sm:block">
                        <!-- ID für JS Zugriff hinzugefügt -->
                        <div id="current-user-name" class="text-xs font-bold text-white uppercase tracking-tighter">GUEST</div>
                        <div class="text-[9px] text-teal-400 font-bold uppercase tracking-widest">System Online</div>
                    </div>
                    <div class="w-10 h-10 rounded-full bg-slate-900 flex items-center justify-center border border-white/10 cursor-pointer hover:border-teal-500/50 transition-all shadow-2xl group overflow-hidden">
                        <i class="fa-solid fa-user-tie text-slate-500 group-hover:text-teal-400 transition-colors"></i>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="w-full max-w-6xl px-4 sm:px-6 lg:px-8 space-y-8 z-10 pb-12">

        <!-- Hero Section -->
        <div class="glass-panel rounded-[2.5rem] p-8 md:p-10 relative group overflow-visible">
            <div class="flex flex-col md:flex-row items-center justify-between gap-8 relative z-10">
                <div class="text-center md:text-left">
                    <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-teal-500/10 border border-teal-500/20 text-teal-300 text-[10px] font-black tracking-widest uppercase mb-6 shadow-[0_0_25px_rgba(45,212,191,0.2)]">
                        <span class="w-2 h-2 rounded-full bg-teal-400 animate-pulse"></span>
                        High Performance Zentrale
                    </div>
                    <h1 class="text-4xl md:text-6xl font-black italic uppercase tracking-tighter neon-title mb-4 leading-none">SALES FORCE<br>ARSCH</h1>
                    <p class="text-slate-500 text-lg font-medium max-w-md mx-auto md:mx-0 leading-relaxed">Die Marktaktivität ist heute überdurchschnittlich. Alle Systeme im Cloud-Sync sind bereit für die nächste Skalierung.</p>
                    <div class="flex flex-wrap justify-center md:justify-start gap-4 mt-8">
                        <a href="#" class="glass-btn px-8 py-4 rounded-2xl text-xs font-black uppercase tracking-widest text-white flex items-center gap-3 bg-white/5 border-teal-500/30 hover:border-teal-400 hover:shadow-[0_0_30px_rgba(45,212,191,0.3)] transition-all"><i class="fa-solid fa-plus text-teal-400"></i> Neuer Lead</a>
                        <a href="#" class="glass-btn px-8 py-4 rounded-2xl text-xs font-black uppercase tracking-widest text-slate-400 flex items-center gap-3 hover:text-white transition-all"><i class="fa-solid fa-file-export"></i> Cloud Bericht</a>
                    </div>
                </div>
                <!-- Target Ring -->
                <div class="w-full md:w-auto min-w-[300px] glass-panel rounded-3xl p-8 bg-black/60 border-white/5 shadow-2xl">
                    <div class="flex justify-between items-center mb-6">
                        <span class="text-[10px] font-black text-slate-600 uppercase tracking-widest">Q4 Meilenstein</span>
                        <span class="text-teal-400 font-black text-xs px-2 py-1 rounded bg-teal-500/10">+12.4%</span>
                    </div>
                    <div class="flex items-baseline gap-1 text-5xl font-black text-white mb-4 tracking-tighter"><span id="kpi-target" class="glow-number">0</span><span class="text-xl text-teal-500">%</span></div>
                    <div class="w-full h-4 bg-black/90 rounded-full overflow-hidden border border-white/5 relative mb-4 p-[1px]">
                        <div id="target-progress" class="absolute top-0 left-0 h-full bg-gradient-to-r from-teal-500 to-cyan-500 rounded-full progress-bar shadow-[0_0_20px_rgba(45,212,191,0.5)]" style="width: 0%;"></div>
                    </div>
                    <div class="flex justify-between text-[10px] text-slate-600 font-bold tracking-widest uppercase"><span>Aktuell: €820k</span><span>Ziel: €1.0M</span></div>
                </div>
            </div>
            <div class="absolute top-0 right-0 -mt-20 -mr-20 w-80 h-80 bg-teal-500/5 rounded-full blur-[120px] pointer-events-none"></div>
        </div>

        <!-- KPI Grid -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-6">
            <!-- Pipeline -->
            <div class="glass-panel rounded-3xl p-6 hover:bg-white/5 group flex flex-col justify-between">
                <div>
                    <div class="flex justify-between items-start mb-6">
                        <div class="w-12 h-12 rounded-2xl bg-teal-500/10 flex items-center justify-center text-teal-400 group-hover:scale-110 transition-transform"><i class="fa-solid fa-sack-dollar text-2xl"></i></div>
                        <span class="text-[10px] font-black text-teal-500/80 bg-teal-400/5 px-2 py-1 rounded uppercase">Echtzeit</span>
                    </div>
                    <div class="text-slate-600 text-[10px] font-black uppercase tracking-widest mb-1">Pipeline Value</div>
                    <div class="text-3xl font-black text-white tracking-tighter"><span id="kpi-pipeline-value" class="glow-number">€ 0</span></div>
                </div>
            </div>
            <!-- Deals -->
            <div class="glass-panel rounded-3xl p-6 hover:bg-white/5 group flex flex-col justify-between">
                <div>
                    <div class="flex justify-between items-start mb-6">
                        <div class="w-12 h-12 rounded-2xl bg-cyan-500/10 flex items-center justify-center text-cyan-400 group-hover:scale-110 transition-transform"><i class="fa-solid fa-handshake-simple text-2xl"></i></div>
                        <span class="text-[10px] font-black text-cyan-400/80 bg-cyan-400/5 px-2 py-1 rounded uppercase">Aktiv</span>
                    </div>
                    <div class="text-slate-600 text-[10px] font-black uppercase tracking-widest mb-1">Abschlüsse</div>
                    <div class="text-3xl font-black text-white tracking-tighter"><span id="kpi-units" class="glow-number">0</span></div>
                </div>
            </div>
            <!-- MRR -->
            <div class="glass-panel rounded-3xl p-6 hover:bg-white/5 group flex flex-col justify-between">
                <div>
                    <div class="flex justify-between items-start mb-6">
                        <div class="w-12 h-12 rounded-2xl bg-indigo-500/10 flex items-center justify-center text-indigo-400 group-hover:scale-110 transition-transform"><i class="fa-solid fa-money-bill-trend-up text-2xl"></i></div>
                        <span class="text-[10px] font-black text-emerald-400/80 bg-emerald-500/5 px-2 py-1 rounded uppercase">Monatlich</span>
                    </div>
                    <div class="text-slate-600 text-[10px] font-black uppercase tracking-widest mb-1">Passives Einkommen</div>
                    <div class="text-3xl font-black text-white tracking-tighter"><span id="kpi-passive" class="glow-number">€ 0</span></div>
                </div>
            </div>
            <!-- Vorschau -->
            <div class="glass-panel rounded-3xl p-6 hover:bg-white/5 group flex flex-col justify-between">
                <div>
                    <div class="flex justify-between items-start mb-6">
                        <div class="w-12 h-12 rounded-2xl bg-rose-500/10 flex items-center justify-center text-rose-400 group-hover:scale-110 transition-transform"><i class="fa-solid fa-clock-rotate-left text-2xl"></i></div>
                        <span class="text-[10px] font-black text-rose-400/80 bg-rose-400/5 px-2 py-1 rounded uppercase">Vorschau</span>
                    </div>
                    <div class="text-slate-600 text-[10px] font-black uppercase tracking-widest mb-1">Nächste Auszahlung</div>
                    <div class="text-3xl font-black text-white tracking-tighter whitespace-nowrap">In <span id="kpi-payout" class="glow-number">0</span> Tagen</div>
                </div>
            </div>
        </div>

        <!-- Main Section Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- HOT PIPELINE (Live Data) -->
            <div class="lg:col-span-2 glass-panel rounded-[2.5rem] p-8">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-xl font-black text-white uppercase tracking-widest flex items-center gap-4"><i class="fa-solid fa-bolt-lightning text-teal-400"></i> Hot Pipeline</h2>
                    <div class="flex gap-2"><button class="px-4 py-2 rounded-xl bg-teal-500/20 border border-teal-500/30 text-[10px] font-black uppercase tracking-widest text-teal-300">Hohe Wahrscheinlichkeit</button></div>
                </div>
                <div id="pipeline-container" class="space-y-4 max-h-[500px] overflow-y-auto pr-2">
                    <div class="p-6 rounded-2xl bg-white/5 border border-white/5 animate-pulse">
                        <div class="h-6 w-1/2 bg-white/10 rounded mb-3"></div>
                        <div class="h-4 w-3/4 bg-white/5 rounded"></div>
                    </div>
                </div>
            </div>

            <!-- Activity -->
            <div class="glass-panel rounded-[2.5rem] p-8 flex flex-col h-full">
                <h2 class="text-xl font-black text-white uppercase tracking-widest mb-8 flex items-center gap-4"><i class="fa-solid fa-list-check text-rose-400"></i> Fokus-Aktivitäten</h2>
                <div class="space-y-8 flex-1">
                    <div>
                        <div class="flex justify-between text-[10px] font-black text-slate-500 mb-3 uppercase tracking-widest"><span>Strategische Akquise</span><span id="focus1-val">0 / 0</span></div>
                        <div class="w-full h-3 bg-black/80 rounded-full overflow-hidden p-[1px] border border-white/5"><div id="focus1-bar" class="h-full bg-gradient-to-r from-rose-600 to-pink-500 rounded-full shadow-[0_0_15px_rgba(244,63,94,0.4)]" style="width: 0%"></div></div>
                    </div>
                    <div>
                        <div class="flex justify-between text-[10px] font-black text-slate-500 mb-3 uppercase tracking-widest"><span>Partner-Ausbau</span><span id="focus2-val">0 / 0</span></div>
                        <div class="w-full h-3 bg-black/80 rounded-full overflow-hidden p-[1px] border border-white/5"><div id="focus2-bar" class="h-full bg-gradient-to-r from-teal-500 to-cyan-500 rounded-full shadow-[0_0_15px_rgba(45,212,191,0.4)]" style="width: 0%"></div></div>
                    </div>
                    <div class="pt-8 mt-4 border-t border-white/10">
                        <p class="text-[10px] font-black text-slate-700 uppercase mb-6 tracking-widest">Globaler Zeitplan</p>
                        <div class="relative pl-6 space-y-8 border-l border-white/10 ml-2">
                            <div class="relative">
                                <div class="absolute -left-[29px] top-1 w-4 h-4 rounded-full bg-teal-500 border-4 border-black shadow-[0_0_15px_rgba(20,184,166,0.6)]"></div>
                                <div class="text-[10px] font-black text-teal-400 mb-1 uppercase">14:00 MEZ</div>
                                <div class="font-bold text-white text-sm">Demo: Müller Energy Group</div>
                            </div>
                            <div class="relative">
                                <div class="absolute -left-[29px] top-1 w-4 h-4 rounded-full bg-slate-800 border-4 border-black"></div>
                                <div class="text-[10px] font-black text-slate-700 mb-1 uppercase">15:30 MEZ</div>
                                <div class="font-bold text-slate-500 text-sm">Pipeline-Überprüfung APAC</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Map -->
        <div class="glass-panel rounded-[2.5rem] p-8 relative overflow-hidden">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-xl font-black text-white uppercase tracking-widest flex items-center gap-4"><i class="fa-solid fa-earth-europe text-indigo-400"></i> Marktpräsenz</h2>
                <div class="flex gap-6">
                    <div class="flex items-center gap-2 text-[10px] font-black text-slate-600 uppercase tracking-widest"><span class="w-2 h-2 rounded-full bg-teal-500"></span> Kernmärkte</div>
                    <div class="flex items-center gap-2 text-[10px] font-black text-slate-600 uppercase tracking-widest"><span class="w-2 h-2 rounded-full bg-cyan-500"></span> Expansionsgebiet</div>
                </div>
            </div>
            <div id="map" class="w-full h-[450px] rounded-3xl border border-white/5 grayscale-[0.8] hover:grayscale-[0.3] transition-all duration-1000 shadow-inner"></div>
        </div>

        <!-- Quick Action -->
        <div class="glass-panel rounded-[2.5rem] p-1 bg-gradient-to-r from-teal-500/10 to-transparent">
            <div class="rounded-[2.4rem] bg-black/80 p-10 md:p-12 backdrop-blur-xl">
                <div class="flex items-center gap-5 mb-10">
                    <div class="w-14 h-14 rounded-2xl bg-teal-500/10 flex items-center justify-center text-teal-400 shadow-[0_0_20px_rgba(45,212,191,0.15)]"><i class="fa-solid fa-bolt-lightning text-2xl"></i></div>
                    <div>
                        <h2 class="text-2xl font-black text-white uppercase tracking-wider">Schnell-Eintrag</h2>
                        <p class="text-slate-600 text-xs font-bold mt-1">Direkter CRM Cloud-Sync aktiv</p>
                    </div>
                </div>
                <form onsubmit="event.preventDefault();" class="flex flex-col lg:flex-row gap-6">
                    <div class="flex-1 space-y-2">
                        <label class="text-[9px] font-black text-slate-600 uppercase tracking-widest ml-1">Unternehmen</label>
                        <input type="text" placeholder="Name" class="w-full px-6 py-4 rounded-2xl glass-input placeholder-slate-700 focus:ring-2 focus:ring-teal-500/30 transition-all font-bold">
                    </div>
                    <div class="w-full lg:w-48 space-y-2">
                        <label class="text-[9px] font-black text-slate-600 uppercase tracking-widest ml-1">Schätzwert</label>
                        <input type="number" placeholder="€" class="w-full px-6 py-4 rounded-2xl glass-input placeholder-slate-700 focus:ring-2 focus:ring-teal-500/30 transition-all font-bold">
                    </div>
                    <div class="flex-1 space-y-2">
                        <label class="text-[9px] font-black text-slate-600 uppercase tracking-widest ml-1">Nächster Schritt</label>
                        <input type="text" placeholder="Aktion..." class="w-full px-6 py-4 rounded-2xl glass-input placeholder-slate-700 focus:ring-2 focus:ring-teal-500/30 transition-all font-bold">
                    </div>
                    <button type="submit" class="lg:mt-6 px-10 py-4 rounded-2xl bg-gradient-to-r from-teal-700 to-cyan-800 hover:from-teal-600 hover:to-cyan-700 text-white font-black uppercase tracking-widest shadow-2xl transition-all transform hover:scale-105 active:scale-95 border border-white/5">Lead hinzufügen</button>
                </form>
            </div>
        </div>
        
    </main>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <!-- Lenis JS (Smooth Scrolling) -->
    <script src="https://unpkg.com/lenis@1.0.45/dist/lenis.min.js"></script>

    <script>
        // --- LENIS INITIALIZATION ---
        const lenis = new Lenis({
            duration: 1.2,
            easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
            direction: 'vertical',
            gestureDirection: 'vertical',
            smooth: true,
            mouseMultiplier: 1,
            smoothTouch: false,
            touchMultiplier: 2,
        });

        function raf(time) {
            lenis.raf(time);
            requestAnimationFrame(raf);
        }

        requestAnimationFrame(raf);

        // --- DASHBOARD LOGIC ---
        // Neue, korrigierte Produktions-URL
        const WEBHOOK_URL = 'https://n8n.srv1164949.hstgr.cloud/webhook/dfd9dbf0-7c8b-470e-910e-fddec3bae8e9';

        // --- ZERO TRUST LOGIC (Frontend Only) ---
        // Das ist die Browser-freundliche Version, die direkt in der HTML-Datei funktioniert
        async function loadUserData() {
            let userData = { email: 'guest@simulation.local' }; // Standard Simulation Data für Preview
            let isCloudflare = false;

            try {
                // 1. Benutzeridentität von Cloudflare Access abrufen
                // Dieser Endpoint existiert automatisch, wenn die Seite hinter Access liegt.
                const response = await fetch('/cdn-cgi/access/get-identity');
                
                if (response.ok) {
                    userData = await response.json(); // Liefert { email: "user@example.com", ... }
                    isCloudflare = true;
                } else {
                    console.warn("Preview Modus (Kein Cloudflare Access erkannt). Nutze Simulations-Daten.");
                }
            } catch (e) {
                console.warn("Konnte User-Daten nicht laden (Vermutlich lokaler Modus):", e);
            }

            // 2. UI Aktualisieren (Email oben rechts anzeigen)
            if (userData.email) {
                document.getElementById('current-user-name').innerText = isCloudflare ? userData.email : "DEV: " + userData.email;
            }

            // 3. Daten an N8n senden, damit der Workflow weiß, wer da ist
            // WICHTIG: Das passiert jetzt IMMER, auch im Preview-Modus (mit Dummy-Daten)
            try {
                console.log("Sende Daten an N8n...", userData);
                await fetch(WEBHOOK_URL + '?action=user_login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        userEmail: userData.email, 
                        timestamp: new Date().toISOString(),
                        action: 'user_identified',
                        environment: isCloudflare ? 'production' : 'preview'
                    })
                });
                console.log("Daten erfolgreich gesendet.");
            } catch (postError) {
                console.error("Fehler beim Senden an N8n:", postError);
            }

            return userData;
        }
        
        function createDealHTML(deal) {
            const isMrr = deal.isMrr;
            const initials = deal.name.substring(0, 2).toUpperCase();
            const valueFormatted = new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR', maximumFractionDigits: 0 }).format(deal.value);

            return `
            <div class="group flex items-center justify-between p-6 rounded-2xl bg-black/40 border border-white/5 hover:border-teal-500/40 transition-all cursor-pointer shadow-xl">
                <div class="flex items-center gap-5">
                    <div class="w-14 h-14 rounded-2xl bg-slate-900 flex items-center justify-center text-white font-black border border-white/10 shadow-2xl">
                        ${initials}
                    </div>
                    <div>
                        <h3 class="font-black text-white text-lg tracking-tight">${deal.name}</h3>
                        <div class="flex items-center gap-2 mt-1">
                            <span class="w-2 h-2 rounded-full ${isMrr ? 'bg-cyan-500' : 'bg-teal-500'} ${isMrr ? '' : 'animate-pulse'}"></span>
                            <p class="text-[10px] text-slate-600 font-bold uppercase tracking-widest">${isMrr ? 'Vertragsverhandlung' : 'Entscheider-Phase'}</p>
                        </div>
                    </div>
                </div>
                <div class="text-right">
                    <div class="font-black text-xl text-white tracking-tighter">${valueFormatted}</div>
                    <div class="text-[10px] font-black text-teal-400 bg-teal-500/10 px-3 py-1 rounded-full mt-2 inline-block">
                        ${isMrr ? 'MRR / Abo' : 'High Prob.'}
                    </div>
                </div>
            </div>
            `;
        }

        async function fetchLiveStats() {
            try {
                // Wir nutzen denselben Webhook für die Stats, senden aber keine User-Daten im GET Request
                // (Oder du nutzt POST, falls dein N8n Workflow das erwartet)
                // Hier auch einen Parameter für GET hinzufügen
                const response = await fetch(WEBHOOK_URL + '?action=get_stats');
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                
                // KPIs aktualisieren
                if (data.pipeline) smartAnimate('kpi-pipeline-value', data.pipeline, { prefix: '€ ', isCurrency: true });
                if (data.mrr) smartAnimate('kpi-passive', data.mrr, { prefix: '€ ', isCurrency: true });
                if (data.deals) smartAnimate('kpi-units', data.deals);

                // Liste Rendern
                const container = document.getElementById('pipeline-container');
                if (data.recentDeals && Array.isArray(data.recentDeals)) {
                    container.innerHTML = ''; 
                    data.recentDeals.forEach((deal, index) => {
                        setTimeout(() => {
                            container.insertAdjacentHTML('beforeend', createDealHTML(deal));
                        }, index * 100);
                    });
                }

            } catch (error) {
                console.error("Live Daten Fetch Fehler:", error);
                const container = document.getElementById('pipeline-container');
                if(container && container.children.length <= 1) {
                   container.innerHTML = `<div class="text-center text-slate-500 text-xs py-10 font-bold uppercase tracking-widest">
                       Verbindung unterbrochen <br> <span style="font-size:9px; opacity:0.7">Prüfe CORS / Webhook</span>
                   </div>`;
                }
            }
        }

        function smartAnimate(id, endValue, options = {}) {
            const obj = document.getElementById(id);
            if (!obj) return;
            const currentText = obj.innerText.replace(/\D/g, ''); 
            const startValue = parseInt(currentText) || 0;
            if (startValue !== endValue) {
                animateValue(obj, startValue, endValue, 2000, options);
            }
        }

        function animateValue(obj, start, end, duration, formatOptions = {}) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                const easeProgress = 1 - (1 - progress) * (1 - progress); 
                const current = easeProgress * (end - start) + start;
                
                let value = current;
                if (formatOptions.isCurrency) {
                    value = new Intl.NumberFormat('de-DE', { maximumFractionDigits: 0 }).format(current);
                    obj.innerHTML = (formatOptions.prefix || '') + value;
                } else {
                    value = Math.floor(current);
                    obj.innerHTML = (formatOptions.prefix || '') + value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                }
                if (progress < 1) window.requestAnimationFrame(step);
            };
            window.requestAnimationFrame(step);
        }

        window.onload = () => {
            // Statische Animationen
            animateValue(document.getElementById('kpi-target'), 0, 82, 2000);
            setTimeout(() => { document.getElementById('target-progress').style.width = '82%'; }, 100);
            animateValue(document.getElementById('kpi-payout'), 0, 3, 1500);

            // 1. Map initialisieren
            const map = L.map('map', { zoomControl: false }).setView([51.1657, 10.4515], 6); 
            L.control.zoom({ position: 'topright' }).addTo(map);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', { attribution: '&copy; CARTO' }).addTo(map);
            const locations = [
                { lat: 52.5200, lng: 13.4050, name: "TechCorp HQ", value: "€45k", type: "hot", city: "Berlin" }, 
                { lat: 48.1351, lng: 11.5820, name: "Müller Group", value: "€12k", type: "warm", city: "München" }, 
                { lat: 53.5511, lng: 9.9937, name: "Innovate AG", value: "€120k", type: "hot", city: "Hamburg" }, 
                { lat: 50.1109, lng: 8.6821, name: "Finance Hub", value: "€32k", type: "warm", city: "Frankfurt" },
                { lat: 47.3769, lng: 8.5417, name: "Crypto Valley", value: "€65k", type: "hot", city: "Zürich" }
            ];
            locations.forEach(loc => {
                let color = loc.type === 'hot' ? '#14b8a6' : '#06b6d4';
                let radius = loc.type === 'hot' ? 14 : 10;
                const circle = L.circleMarker([loc.lat, loc.lng], { color: color, fillColor: color, fillOpacity: 0.8, radius: radius, weight: 2 }).addTo(map);
                circle.bindPopup(`<div style="font-family: 'Plus Jakarta Sans', sans-serif;"><div style="font-size: 8px; font-weight: 800; color: #475569; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 4px;">${loc.city}</div><div style="font-weight: 900; font-size: 14px; color: #fff;">${loc.name}</div><div style="margin-top: 10px; color: #2dd4bf; font-weight: 800; font-size: 12px;">Wert: ${loc.value}</div></div>`);
                circle.on('mouseover', function (e) { this.openPopup(); });
            });

            // 2. Benutzer-Daten laden (Zero Trust Check)
            loadUserData();

            // 3. Live Daten Fetch Starten
            fetchLiveStats();
            setInterval(fetchLiveStats, 10000);
        };
    </script>
</body>
</html>
